import React, { useState, useEffect } from 'react';
import { Calendar, CheckSquare, Dumbbell, Target, Clock, Plus, X, Play, Pause, RotateCcw, TrendingUp, ListTodo, Zap, Edit2, Trash2, Save, BarChart3 } from 'lucide-react';
import { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';

export default function ProductivityApp() {
  const [activeTab, setActiveTab] = useState('habits');
  const [editingHabit, setEditingHabit] = useState(null);
  const [editingTodo, setEditingTodo] = useState(null);
  const [editingProject, setEditingProject] = useState(null);
  const [chartView, setChartView] = useState('week'); // day, week, month
  
  const [habits, setHabits] = useState([
    { 
      id: 1, 
      name: '10,000 Steps', 
      entries: [
        { date: '2024-11-12', completed: true },
        { date: '2024-11-13', completed: true },
        { date: '2024-11-14', completed: true },
        { date: '2024-11-15', completed: false },
        { date: '2024-11-16', completed: true },
        { date: '2024-11-17', completed: true },
        { date: '2024-11-18', completed: true },
      ]
    },
    { 
      id: 2, 
      name: 'Track Weight',
      entries: [
        { date: '2024-11-12', completed: true },
        { date: '2024-11-13', completed: true },
        { date: '2024-11-14', completed: false },
        { date: '2024-11-15', completed: true },
        { date: '2024-11-16', completed: true },
        { date: '2024-11-17', completed: true },
        { date: '2024-11-18', completed: true },
      ]
    },
  ]);
  
  const [weight, setWeight] = useState([
    { date: '2024-11-12', value: 80.0 },
    { date: '2024-11-13', value: 79.8 },
    { date: '2024-11-14', value: 79.6 },
    { date: '2024-11-15', value: 79.3 },
    { date: '2024-11-16', value: 79.0 },
    { date: '2024-11-17', value: 78.8 },
    { date: '2024-11-18', value: 78.6 },
  ]);
  
  const [todos, setTodos] = useState([
    { id: 1, text: 'Complete 5 practice problems', time: '50 min', completed: false },
    { id: 2, text: 'Meal prep 3 high-protein lunches', time: '45 min', completed: true },
    { id: 3, text: 'Calculate daily calorie targets', time: '20 min', completed: true },
  ]);
  
  const [projects, setProjects] = useState([
    { id: 1, name: 'Fitness Challenge', tasks: 15, completed: 8, color: 'bg-blue-600' },
    { id: 2, name: 'Learning Journey', tasks: 20, completed: 12, color: 'bg-indigo-600' },
    { id: 3, name: 'Side Project', tasks: 10, completed: 3, color: 'bg-cyan-600' },
  ]);
  
  const [timers, setTimers] = useState([
    { id: 1, name: 'Movement Break', duration: 3600, remaining: 3600, active: false, type: 'reminder' },
    { id: 2, name: 'Deep Work Session', duration: 1500, remaining: 1500, active: false, type: 'focus' },
    { id: 3, name: 'Task Switch', duration: 1800, remaining: 1800, active: false, type: 'switch' },
  ]);
  
  const [newTodo, setNewTodo] = useState('');
  const [newHabit, setNewHabit] = useState('');
  const [aiGoal, setAiGoal] = useState('');
  const [aiTasks, setAiTasks] = useState([]);

  // Load data from storage on mount
  useEffect(() => {
    const loadData = async () => {
      try {
        const result = await window.storage.get('productivity-data');
        if (result && result.value) {
          const data = JSON.parse(result.value);
          if (data.habits) setHabits(data.habits);
          if (data.weight) setWeight(data.weight);
          if (data.todos) setTodos(data.todos);
          if (data.projects) setProjects(data.projects);
        }
      } catch (error) {
        console.log('No saved data found, starting fresh');
      }
    };
    loadData();
  }, []);

  // Save data to storage whenever it changes
  useEffect(() => {
    const saveData = async () => {
      try {
        await window.storage.set('productivity-data', JSON.stringify({
          habits,
          weight,
          todos,
          projects
        }));
      } catch (error) {
        console.error('Error saving data:', error);
      }
    };
    saveData();
  }, [habits, weight, todos, projects]);

  useEffect(() => {
    const interval = setInterval(() => {
      setTimers(prev => prev.map(timer => {
        if (timer.active && timer.remaining > 0) {
          return { ...timer, remaining: timer.remaining - 1 };
        }
        if (timer.active && timer.remaining === 0) {
          return { ...timer, active: false };
        }
        return timer;
      }));
    }, 1000);
    return () => clearInterval(interval);
  }, []);

  const formatDate = (date) => {
    const d = new Date(date);
    return `${d.getMonth() + 1}/${d.getDate()}`;
  };

  const getLast7Days = () => {
    const days = [];
    for (let i = 6; i >= 0; i--) {
      const d = new Date();
      d.setDate(d.getDate() - i);
      days.push(d.toISOString().split('T')[0]);
    }
    return days;
  };

  const getLast30Days = () => {
    const days = [];
    for (let i = 29; i >= 0; i--) {
      const d = new Date();
      d.setDate(d.getDate() - i);
      days.push(d.toISOString().split('T')[0]);
    }
    return days;
  };

  const getHabitChartData = () => {
    const dates = chartView === 'month' ? getLast30Days() : getLast7Days();
    return dates.map(date => {
      const dataPoint = { date: formatDate(date) };
      habits.forEach(habit => {
        const entry = habit.entries.find(e => e.date === date);
        dataPoint[habit.name] = entry && entry.completed ? 1 : 0;
      });
      return dataPoint;
    });
  };

  const getWeightChartData = () => {
    const dates = chartView === 'month' ? getLast30Days() : getLast7Days();
    return dates.map(date => {
      const entry = weight.find(w => w.date === date);
      return {
        date: formatDate(date),
        weight: entry ? entry.value : null
      };
    }).filter(d => d.weight !== null);
  };

  const toggleHabitForDate = (habitId, date) => {
    setHabits(prev => prev.map(h => {
      if (h.id === habitId) {
        const existingEntry = h.entries.find(e => e.date === date);
        if (existingEntry) {
          return {
            ...h,
            entries: h.entries.map(e => 
              e.date === date ? { ...e, completed: !e.completed } : e
            )
          };
        } else {
          return {
            ...h,
            entries: [...h.entries, { date, completed: true }]
          };
        }
      }
      return h;
    }));
  };

  const addTodo = () => {
    if (newTodo.trim()) {
      setTodos(prev => [...prev, { id: Date.now(), text: newTodo, time: '30 min', completed: false }]);
      setNewTodo('');
    }
  };

  const updateTodo = (id, updates) => {
    setTodos(prev => prev.map(t => t.id === id ? { ...t, ...updates } : t));
  };

  const deleteTodo = (id) => {
    setTodos(prev => prev.filter(t => t.id !== id));
  };

  const toggleTodo = (id) => {
    setTodos(prev => prev.map(t => t.id === id ? { ...t, completed: !t.completed } : t));
  };

  const addHabit = () => {
    if (newHabit.trim()) {
      setHabits(prev => [...prev, { id: Date.now(), name: newHabit, entries: [] }]);
      setNewHabit('');
    }
  };

  const updateHabit = (id, newName) => {
    setHabits(prev => prev.map(h => h.id === id ? { ...h, name: newName } : h));
    setEditingHabit(null);
  };

  const deleteHabit = (id) => {
    setHabits(prev => prev.filter(h => h.id !== id));
  };

  const updateProject = (id, updates) => {
    setProjects(prev => prev.map(p => p.id === id ? { ...p, ...updates } : p));
  };

  const deleteProject = (id) => {
    setProjects(prev => prev.filter(p => p.id !== id));
  };

  const addWeightEntry = (value) => {
    const today = new Date().toISOString().split('T')[0];
    const existing = weight.find(w => w.date === today);
    if (existing) {
      setWeight(prev => prev.map(w => w.date === today ? { ...w, value: parseFloat(value) } : w));
    } else {
      setWeight(prev => [...prev, { date: today, value: parseFloat(value) }]);
    }
  };

  const toggleTimer = (id) => {
    setTimers(prev => prev.map(t => t.id === id ? { ...t, active: !t.active } : t));
  };

  const resetTimer = (id) => {
    setTimers(prev => prev.map(t => t.id === id ? { ...t, remaining: t.duration, active: false } : t));
  };

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  const generateAiTasks = () => {
    const taskSuggestions = [
      `Research best practices for ${aiGoal}`,
      `Create a detailed plan with milestones`,
      `Set up daily tracking system`,
      `Identify resources and tools needed`,
      `Schedule dedicated time blocks`,
      `Find accountability partner or community`,
    ];
    setAiTasks(taskSuggestions.slice(0, 4));
  };

  const last7Days = getLast7Days();

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-950 p-4">
      <div className="max-w-7xl mx-auto">
        <div className="bg-gradient-to-r from-blue-900/40 to-indigo-900/40 backdrop-blur-xl rounded-2xl shadow-2xl p-6 mb-6 border border-blue-800/30">
          <h1 className="text-4xl font-bold text-white mb-2 flex items-center gap-3">
            <Zap className="text-blue-400" size={36} />
            ProductivityHub
          </h1>
          <p className="text-blue-200">Your all-in-one life management system</p>
        </div>

        {/* Navigation */}
        <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
          {[
            { id: 'habits', icon: CheckSquare, label: 'Habits' },
            { id: 'fitness', icon: Dumbbell, label: 'Fitness' },
            { id: 'todos', icon: ListTodo, label: 'To-Dos' },
            { id: 'projects', icon: Target, label: 'Projects' },
            { id: 'timers', icon: Clock, label: 'Timers' },
            { id: 'ai', icon: Zap, label: 'AI Goals' },
          ].map(tab => {
            const Icon = tab.icon;
            return (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all ${
                  activeTab === tab.id
                    ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg scale-105'
                    : 'bg-blue-900/30 text-blue-200 hover:bg-blue-900/50 border border-blue-800/30'
                }`}
              >
                <Icon size={20} />
                {tab.label}
              </button>
            );
          })}
        </div>

        {/* Content Area */}
        <div className="bg-gradient-to-br from-blue-900/40 to-indigo-900/40 backdrop-blur-xl rounded-2xl shadow-2xl p-6 text-white border border-blue-800/30">
          {activeTab === 'habits' && (
            <div>
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-2xl font-bold">Daily Habit Tracker</h2>
                <div className="flex gap-2">
                  <input
                    type="text"
                    value={newHabit}
                    onChange={(e) => setNewHabit(e.target.value)}
                    placeholder="New habit..."
                    className="px-4 py-2 rounded-lg bg-blue-950/50 border border-blue-700/50 text-white placeholder-blue-300"
                    onKeyPress={(e) => e.key === 'Enter' && addHabit()}
                  />
                  <button onClick={addHabit} className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg flex items-center gap-2">
                    <Plus size={20} /> Add
                  </button>
                </div>
              </div>

              {/* Chart View Selector */}
              <div className="flex gap-2 mb-4">
                <button
                  onClick={() => setChartView('week')}
                  className={`px-4 py-2 rounded-lg ${chartView === 'week' ? 'bg-blue-600' : 'bg-blue-900/50'}`}
                >
                  Last 7 Days
                </button>
                <button
                  onClick={() => setChartView('month')}
                  className={`px-4 py-2 rounded-lg ${chartView === 'month' ? 'bg-blue-600' : 'bg-blue-900/50'}`}
                >
                  Last 30 Days
                </button>
              </div>

              {/* Habits Chart */}
              <div className="bg-blue-950/50 rounded-xl p-4 mb-6 border border-blue-800/30">
                <h3 className="text-xl font-semibold mb-4 flex items-center gap-2">
                  <BarChart3 size={24} /> Habit Completion Trends
                </h3>
                <ResponsiveContainer width="100%" height={300}>
                  <BarChart data={getHabitChartData()}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#1e3a8a" />
                    <XAxis dataKey="date" stroke="#93c5fd" />
                    <YAxis stroke="#93c5fd" />
                    <Tooltip 
                      contentStyle={{ backgroundColor: '#1e3a8a', border: '1px solid #3b82f6' }}
                      labelStyle={{ color: '#fff' }}
                    />
                    <Legend />
                    {habits.map((habit, idx) => (
                      <Bar 
                        key={habit.id} 
                        dataKey={habit.name} 
                        fill={['#3b82f6', '#6366f1', '#06b6d4', '#8b5cf6'][idx % 4]}
                      />
                    ))}
                  </BarChart>
                </ResponsiveContainer>
              </div>

              {/* Habits Grid */}
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="border-b border-blue-700/50">
                      <th className="text-left py-3 px-4">Habit</th>
                      {last7Days.map((date, i) => (
                        <th key={i} className="text-center py-3 px-2">
                          {formatDate(date)}
                        </th>
                      ))}
                      <th className="text-center py-3 px-4">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {habits.map(habit => (
                      <tr key={habit.id} className="border-b border-blue-800/30 hover:bg-blue-900/30">
                        <td className="py-3 px-4">
                          {editingHabit === habit.id ? (
                            <div className="flex gap-2">
                              <input
                                type="text"
                                defaultValue={habit.name}
                                className="px-2 py-1 rounded bg-blue-950/50 border border-blue-700/50"
                                onKeyPress={(e) => {
                                  if (e.key === 'Enter') {
                                    updateHabit(habit.id, e.target.value);
                                  }
                                }}
                              />
                              <button
                                onClick={() => setEditingHabit(null)}
                                className="text-blue-400 hover:text-blue-300"
                              >
                                <Save size={16} />
                              </button>
                            </div>
                          ) : (
                            <span className="font-semibold">{habit.name}</span>
                          )}
                        </td>
                        {last7Days.map((date, idx) => {
                          const entry = habit.entries.find(e => e.date === date);
                          const completed = entry && entry.completed;
                          return (
                            <td key={idx} className="text-center py-3 px-2">
                              <button
                                onClick={() => toggleHabitForDate(habit.id, date)}
                                className={`w-8 h-8 rounded-lg transition-all ${
                                  completed ? 'bg-blue-500 shadow-lg' : 'bg-blue-900/50 border border-blue-700/50'
                                }`}
                              >
                                {completed && <CheckSquare size={16} className="mx-auto" />}
                              </button>
                            </td>
                          );
                        })}
                        <td className="text-center py-3 px-4">
                          <div className="flex gap-2 justify-center">
                            <button
                              onClick={() => setEditingHabit(habit.id)}
                              className="text-blue-400 hover:text-blue-300"
                            >
                              <Edit2 size={16} />
                            </button>
                            <button
                              onClick={() => deleteHabit(habit.id)}
                              className="text-red-400 hover:text-red-300"
                            >
                              <Trash2 size={16} />
                            </button>
                          </div>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          )}

          {activeTab === 'fitness' && (
            <div>
              <h2 className="text-2xl font-bold mb-6">Fitness Tracking</h2>

              {/* Chart View Selector */}
              <div className="flex gap-2 mb-4">
                <button
                  onClick={() => setChartView('week')}
                  className={`px-4 py-2 rounded-lg ${chartView === 'week' ? 'bg-blue-600' : 'bg-blue-900/50'}`}
                >
                  Last 7 Days
                </button>
                <button
                  onClick={() => setChartView('month')}
                  className={`px-4 py-2 rounded-lg ${chartView === 'month' ? 'bg-blue-600' : 'bg-blue-900/50'}`}
                >
                  Last 30 Days
                </button>
              </div>

              {/* Weight Chart */}
              <div className="bg-blue-950/50 rounded-xl p-4 mb-6 border border-blue-800/30">
                <h3 className="text-xl font-semibold mb-4 flex items-center gap-2">
                  <TrendingUp /> Weight Progression
                </h3>
                <ResponsiveContainer width="100%" height={300}>
                  <LineChart data={getWeightChartData()}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#1e3a8a" />
                    <XAxis dataKey="date" stroke="#93c5fd" />
                    <YAxis stroke="#93c5fd" domain={['dataMin - 1', 'dataMax + 1']} />
                    <Tooltip 
                      contentStyle={{ backgroundColor: '#1e3a8a', border: '1px solid #3b82f6' }}
                      labelStyle={{ color: '#fff' }}
                    />
                    <Legend />
                    <Line 
                      type="monotone" 
                      dataKey="weight" 
                      stroke="#3b82f6" 
                      strokeWidth={3}
                      dot={{ fill: '#3b82f6', r: 6 }}
                    />
                  </LineChart>
                </ResponsiveContainer>
              </div>

              <div className="grid md:grid-cols-2 gap-6">
                <div className="bg-blue-950/50 rounded-xl p-4 border border-blue-800/30">
                  <h3 className="text-xl font-semibold mb-4">Add Weight Entry</h3>
                  <div className="flex gap-2">
                    <input
                      type="number"
                      step="0.1"
                      placeholder="Weight (kg)"
                      className="flex-1 px-4 py-2 rounded-lg bg-blue-900/50 border border-blue-700/50 text-white"
                      onKeyPress={(e) => {
                        if (e.key === 'Enter') {
                          addWeightEntry(e.target.value);
                          e.target.value = '';
                        }
                      }}
                    />
                    <button
                      onClick={(e) => {
                        const input = e.target.previousSibling;
                        addWeightEntry(input.value);
                        input.value = '';
                      }}
                      className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg"
                    >
                      <Plus size={20} />
                    </button>
                  </div>
                </div>
                <div className="bg-blue-950/50 rounded-xl p-4 border border-blue-800/30">
                  <h3 className="text-xl font-semibold mb-4">Quick Stats</h3>
                  <div className="space-y-3">
                    <div className="bg-blue-600/30 rounded-lg p-3 border border-blue-500/30">
                      <div className="text-sm text-blue-200">Current Weight</div>
                      <div className="text-2xl font-bold">{weight[weight.length - 1]?.value || 0} kg</div>
                    </div>
                    <div className="bg-green-600/30 rounded-lg p-3 border border-green-500/30">
                      <div className="text-sm text-green-200">Total Change</div>
                      <div className="text-2xl font-bold">
                        {weight.length > 1 ? (weight[weight.length - 1].value - weight[0].value).toFixed(1) : 0} kg
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {activeTab === 'todos' && (
            <div>
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-2xl font-bold">To-Do List</h2>
                <div className="flex gap-2">
                  <input
                    type="text"
                    value={newTodo}
                    onChange={(e) => setNewTodo(e.target.value)}
                    placeholder="Add a new task..."
                    className="px-4 py-2 rounded-lg bg-blue-950/50 border border-blue-700/50 text-white placeholder-blue-300 w-64"
                    onKeyPress={(e) => e.key === 'Enter' && addTodo()}
                  />
                  <button onClick={addTodo} className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg flex items-center gap-2">
                    <Plus size={20} /> Add
                  </button>
                </div>
              </div>
              <div className="space-y-3">
                {todos.map(todo => (
                  <div key={todo.id} className={`flex items-center gap-4 p-4 rounded-xl border ${
                    todo.completed 
                      ? 'bg-green-900/20 border-green-700/30' 
                      : 'bg-blue-950/50 border-blue-800/30'
                  }`}>
                    <button
                      onClick={() => toggleTodo(todo.id)}
                      className={`w-6 h-6 rounded-md border-2 flex items-center justify-center ${
                        todo.completed ? 'bg-green-600 border-green-600' : 'border-blue-400'
                      }`}
                    >
                      {todo.completed && <CheckSquare size={16} />}
                    </button>
                    <div className="flex-1">
                      {editingTodo === todo.id ? (
                        <input
                          type="text"
                          defaultValue={todo.text}
                          className="w-full px-2 py-1 rounded bg-blue-950/50 border border-blue-700/50"
                          onKeyPress={(e) => {
                            if (e.key === 'Enter') {
                              updateTodo(todo.id, { text: e.target.value });
                              setEditingTodo(null);
                            }
                          }}
                        />
                      ) : (
                        <div className={`font-semibold ${todo.completed ? 'line-through text-white/60' : ''}`}>
                          {todo.text}
                        </div>
                      )}
                      <div className="text-sm text-blue-300 flex items-center gap-1 mt-1">
                        <Clock size={14} /> {todo.time}
                      </div>
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={() => setEditingTodo(editingTodo === todo.id ? null : todo.id)}
                        className="text-blue-400 hover:text-blue-300"
                      >
                        <Edit2 size={16} />
                      </button>
                      <button
                        onClick={() => deleteTodo(todo.id)}
                        className="text-red-400 hover:text-red-300"
                      >
                        <Trash2 size={16} />
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {activeTab === 'projects' && (
            <div>
              <h2 className="text-2xl font-bold mb-6">Projects</h2>
              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                {projects.map(project => {
                  const progress = Math.round((project.completed / project.tasks) * 100);
                  return (
                    <div key={project.id} className="bg-blue-950/50 rounded-xl p-6 hover:bg-blue-900/40 transition-all border border-blue-800/30">
                      <div className={`w-12 h-12 ${project.color} rounded-lg mb-4 flex items-center justify-center`}>
                        <Target size={24} />
                      </div>
                      {editingProject === project.id ? (
                        <input
                          type="text"
                          defaultValue={project.name}
                          className="w-full px-2 py-1 mb-2 rounded bg-blue-950/50 border border-blue-700/50 text-lg font-bold"
                          onKeyPress={(e) => {
                            if (e.key === 'Enter') {
                              updateProject(project.id, { name: e.target.value });
                              setEditingProject(null);
                            }
                          }}
                        />
                      ) : (
                        <h3 className="text-xl font-bold mb-2">{project.name}</h3>
                      )}
                      <div className="text-sm text-blue-300 mb-3">
                        {project.completed} of {project.tasks} tasks completed
                      </div>
                      <div className="w-full bg-blue-900/50 rounded-full h-2 mb-2">
                        <div className={`${project.color} h-2 rounded-full transition-all`} style={{ width: `${progress}%` }} />
                      </div>
                      <div className="flex justify-between items-center">
                        <div className="text-right text-sm font-semibold">{progress}%</div>
                        <div className="flex gap-2">
                          <button
                            onClick={() => setEditingProject(editingProject === project.id ? null : project.id)}
                            className="text-blue-400 hover:text-blue-300"
                          >
                            <Edit2 size={16} />
                          </button>
                          <button
                            onClick={() => deleteProject(project.id)}
                            className="text-red-400 hover:text-red-300"
                          >
                            <Trash2 size={16} />
                          </button>
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          )}

          {activeTab === 'timers' && (
            <div>
              <h2 className="text-2xl font-bold mb-6">Smart Timers</h2>
              <div className="grid md:grid-cols-3 gap-6">
                {timers.map(timer => {
                  const progress = ((timer.duration - timer.remaining) / timer.duration) * 100;
                  return (
                    <div key={timer.id} className="bg-blue-950/50 rounded-xl p-6 border border-blue-800/30">
                      <h3 className="text-lg font-semibold mb-4">{timer.name}</h3>
                      <div className="text-5xl font-bold text-center mb-4">{formatTime(timer.remaining)}</div>
                      <div className="w-full bg-blue-900/50 rounded-full h-2 mb-4">
                        <div className="bg-gradient-to-r from-blue-500 to-indigo-500 h-2 rounded-full transition-all" style={{ width: `${progress}%` }} />
                      </div>
                      <div className="flex gap-2">
                        <button
                          onClick={() => toggleTimer(timer.id)}
                          className="flex-1 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg flex items-center justify-center gap-2"
                        >
                          {timer.active ? <Pause size={20} /> : <Play size={20} />}
                          {timer.active ? 'Pause' : 'Start'}
                        </button>
                        <button
                          onClick={() => resetTimer(timer.id)}
                          className="bg-blue-900/50 hover:bg-blue-900/70 px-4 py-2 rounded-lg border border-blue-700/50"
                        >
                          <RotateCcw size={20} />
                        </button>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          )}

          {activeTab === 'ai' && (
            <div>
              <h2 className="text-2xl font-bold mb-6 flex items-center gap-2">
                <Zap className="text-blue-400" /> AI Goal Assistant
              </h2>
              <div className="bg-blue-950/50 rounded-xl p-6 mb-6 border border-blue-800/30">
                <p className="text-blue-200 mb-4">Tell me your goal, and I'll break it down into actionable tasks!</p>
                <div className="flex gap-2">
                  <input
                    type="text"
                    value={aiGoal}
                    onChange={(e) => setAiGoal(e.target.value)}
                    placeholder="e.g., Lose 10kg in 3 months, Learn Python, Build a portfolio..."
                    className="flex-1 px-4 py-3 rounded-lg bg-blue-900/50 border border-blue-700/50 text-white placeholder-blue-300"
                  />
                  <button
                    onClick={generateAiTasks}
                    className="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 px-6 py-3 rounded-lg flex items-center gap-2 font-semibold"
                  >
                    <Zap size={20} /> Generate Tasks
                  </button>
                </div>
              </div>
              
              {aiTasks.length > 0 && (
                <div>
                  <h3 className="text-xl font-semibold mb-4">Suggested Action Plan:</h3>
                  <div className="space-y-3">
                    {aiTasks.map((task, idx) => (
                      <div key={idx} className="bg-gradient-to-r from-blue-600/20 to-indigo-600/20 rounded-xl p-4 flex items-center gap-4 border border-blue-700/30">
                        <div className="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center font-bold">
                          {idx + 1}
                        </div>
                        <div className="flex-1">{task}</div>
                        <button className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm">
                          Add to To-Dos
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
